<!DOCTYPE html>
    <html>
        <head>
            <title> Project - Group (6): The Grand Exchange </title>
            <link rel="stylesheet" type="text/css" href="style.css" />
        </head>
        
        <script>
            // define the createListing function that takes a first name and last name as parameters
            var getListings = async () => {
                // instantiate a headers object
                var myHeaders = new Headers();
                // add content type header to object
                myHeaders.append("Content-Type", "application/json");
                // create a JSON object with parameters for API call and store in a variable
                var requestOptions = {
                    method: 'GET',
                    headers: myHeaders,
                    redirect: 'follow'
                };
                // make API call with parameters and use promises to get response
                result = await fetch("https://a90jbgdg3a.execute-api.us-east-1.amazonaws.com/dev", requestOptions);
                return result;
            }

            var printListings = async () => {
                // json = JSON.parse(result).body;
                var table = document.getElementById('listings'),
                    _tr_ = document.createElement('tr'),
                    _td_ = document.createElement('td');
                    const response = await getListings();
                    const json = await response.json();
                    listArray = json.body;

                    for (var i = 0; i < listArray.length; ++i) {  //hardcoded with 4 headers
                        var obj = JSON.parse(listArray[i]);
                        var tr = _tr_.cloneNode(false);
                        var td1 = _td_.cloneNode(false),
                            td2 = _td_.cloneNode(false),
                            td3 = _td_.cloneNode(false),
                            td4 = _td_.cloneNode(false);
                            td1.appendChild(document.createTextNode(obj['title'] || ''));
                            td2.appendChild(document.createTextNode(obj['description'] || ''));
                            td3.appendChild(document.createTextNode(obj['email'] || ''));
                            td4.appendChild(document.createTextNode(obj['number'] || ''));
                            tr.appendChild(td1);
                            tr.appendChild(td2);
                            tr.appendChild(td3);
                            tr.appendChild(td4);
                        table.appendChild(tr);
                    }
                    return table;

            }

        </script>


        <body onload="printListings()">
            <div class="header">
                <h1> Current Listings </h1>
            </div>

            <div class="row">
                <div class="col-3 col-s-3 menu">
                    <ul>
                        <li><a href='index.html'> Home </a> </li>
                        <li><a href='about.html'> About </a> </li>
                        <li><a href='contact.html'> Contact </a> </li>
                        <li><a href='login.html'> User Login </a> </li>
                        <li><a href='listings.html'> Listings </a> </li>
                    </ul>
                </div>
            

                <div class="col-6 col-s-9">
                    <table id="listings">
                        <a href="getListings">Create Listing</a>
                        <tr>
                            <th>
                                title
                            </th>
                            <th>
                                description
                            </th>
                            <th>
                                email
                            </th>
                            <th>
                                number
                            </th>
                        </tr>
                    </table>
                    <br></br>
                    <form action="addListings.html"> <input type="submit" value="Create Listing" /></form>
                </div>
            </div>

            <div class="footer">
                <p> The provided CSS responds to different window sizes and device sizes. While you are not required to work on the asthetics of your project for grade, you may want to improve it if you are trying to build a real web system. </p>
            </div>
        </body>

    </html>
